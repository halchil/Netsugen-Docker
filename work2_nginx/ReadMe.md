# マニフェストファイルを利用したコンテナの起動方法

## 前提知識
dockerプラットフォーム内のvolume,networkについて

## マニフェストファイルとは？

マニフェストファイルとは、コンテナの構成やをコードとして定義するファイルのこと。
これにより、コンテナをどのようにビルド・実行・連携させるかを記述し、
手動で長いコマンドを打たずに、再現性のある環境構築が可能となる。

簡単に言えば 「マニフェストファイル = コンテナ環境の設計図」である。

まずは、マニフェストファイルの内容を参照してみよう。
[docker-compose.yaml](./docker-compose.yaml)

## マニフェストファイルの構成

マニフェストファイルは、yaml形式でインデントにより階層分けされた項目について設定を行う。

### トップレベルキーの解説

Composeファイルの文法を指定し、どんなコンテナを動かすか決め、サービス同士の土台を作る。

version	📘「ファイルの書き方ルールを選ぶ」	使用するComposeファイルの文法バージョンを指定します。書き方や使える機能の範囲を明確にします。

services	🚢「どんなアプリ（コンテナ）を動かすか決める」	実行するアプリケーション（サービス）を定義します。サービスごとに使用するイメージ、ポート、ボリュームなどを指定します。
volumes / networks	📦「サービスどうしの共通の土台をつくる」	複数のサービスが共有するストレージやネットワークなどのインフラ的な要素を定義します。



## マニフェストファイルを利用したコンテナの起動

```
[実行コマンド]
docker compose -f docker-compose.yaml up -d

[結果]

```
コンテナの起動を確認する。

```
[実行コマンド]
docker ps

[結果]

```

次に、実際にページにアクセスして、正しくルーティングされていることを確認する。

```
[アクセスURL]
http://[AWS-URL] → index.htmlが表示
http://[AWS-URL]/test → nginx.confのルーティング表示
http://[AWS-URL]/secret → 403 deny
```

コンテナを停止する。
```
docker compose -f docker-compose.yaml down
```

# 応用問題

Nginxのルーティング設定は[nginx.conf](./nginx/nginx.conf)を参照。

こちらで通信経路をカスタマイズ可能となっている。